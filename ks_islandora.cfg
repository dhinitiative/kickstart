#!/bin/bash

#
# Script to automatically install Drupal, Fedora Commons, and Islandora Modules
#
# 1/9/2014 SLY

# Assumptions:
#
#  - Databases are created in MySQL and you have DB names, users, and passwords for them. 
#     ( one for Fedora Commons and one for Drupal )

#%post
# Uncomment the above and put this at the end of a kickstart file. Also remove /bin/bash line at the top. 
# This was tested with a Basic Server installation in kickstart
#
# Update OS
#
yum -y update
#
# Install any other packages on the OS if needed
#
# yum -y install <package_name>-<package-version>
#
yum -y install gcc
yum -y install gcc-c++
yum -y install autoconf
yum -y install java-1.6.0-openjdk.x86_64
yum -y install ImageMagick
yum -y install ghostscript
yum -y install ant
yum -y install git
#
# Enable EPEL
#
rpm -ivh http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm
#
# Enable RPM Fusion Repo
rpm -ivh http://download1.rpmfusion.org/free/el/updates/6/i386/rpmfusion-free-release-6-1.noarch.rpm
#
# Get RPM Fusion softwares
#
yum -y install ffmpeg
yum -y install xpdf
#
# ffmpeg2theora
#
wget http://v2v.cc/~j/ffmpeg2theora/ffmpeg2theora-0.29.linux64.bin
install -m 755 ffmpeg2theora-0.29.linux64.bin /usr/bin/ffmpeg2theora
#
# End of Operating System Setup
################################


#---------------------------------------------
#
# Variable Declaration (edit these)
#
#---------------------------------------------
#
#
## Set up installation variables
#
export SERVER_NAME=collections
export INSTALL_PREFIX=/opt
export WEB_ROOT=/var/www/html
export IP_ADDR="XX.XX.XX.XX"
export SITES_ALL_MODULES=$WEB_ROOT/sites/all/modules
export SITES_ALL_LIB=$WEB_ROOT/sites/all/libraries

# 
# Get the hamhpc/islandora Git Repo
#
cd /opt
git clone git://github.com/hamhpc/islandora.git

#---------------------------------------------
#
# Configure environment variables
#
#---------------------------------------------
#
$INSTALL_PREFIX/islandora/bin/initialize_env.sh
. $INSTALL_PREFIX/islandora/etc/env.sh
. $INSTALL_PREFIX/islandora/etc/database.sh


#---------------------------------------------
#
# Do the installation
#
#---------------------------------------------
#
$ISLANDORA_HOME/sbin/software_dependancies.install
$ISLANDORA_HOME/sbin/drupal.install
$ISLANDORA_HOME/sbin/fedora.install
$ISLANDORA_HOME/sbin/djatoka.install
$ISLANDORA_HOME/sbin/islandora_modules.install

#%end
# If this is used in kickstart uncomment the above
