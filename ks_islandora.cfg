# Kickstart file automatically generated by anaconda.

#version=DEVEL
install
url --url http://mirror.cogentco.com/pub/linux/centos/6.5/os/x86_64/
lang en_US.UTF-8
keyboard us
network --onboot yes --device eth0 --mtu=1500 --bootproto dhcp
rootpw  --iscrypted $1$KTAmNG9s$b4PRcobrFyG2M5nL/PoN2.
# set to "NotAVeryGoodOne" change with command (openssl passwd -1 “RootPasswordToEncrypt”)
reboot
# Reboot after installation
firewall --disabled
authconfig --useshadow --passalgo=sha512
selinux --disabled
timezone --utc America/New_York
bootloader --location=mbr 
# The following is the partition information you requested
# Note that any partitions you deleted are not expressed
# here so unless you clear all partitions first, this is
# not guaranteed to work
clearpart --all --drives=sda

part /boot --fstype=ext4 --size=500
part pv.008002 --grow --size=1

volgroup vg0 --pesize=4096 pv.008002
logvol / --fstype=ext4 --name=lv_root --vgname=vg0 --grow --size=1024 --maxsize=51200
logvol swap --name=lv_swap --vgname=vg0 --grow --size=2016 --maxsize=4032

%packages
@Base
@Core
@base
@compat-libraries
@console-internet
@core
@debugging
@directory-client
@network-file-system-client
@network-tools
@performance
@server-policy
@storage-client-iscsi
certmonger
dos2unix
iptraf
iptstate
krb5-workstation
lm_sensors
mod_authz_ldap
nscd
nss-pam-ldapd
openldap-clients
pam_krb5
pam_ldap
perl-LDAP
sendmail
sendmail-cf
sgpio
tcp_wrappers
-dovecot
-oddjob-mkhomedir
-postfix
-sssd
-ypbind

%end

%post
##!/bin/bash
# if not using kickstart remove the contents of this file before the /bin/bash, 
# also uncomment /bin/bash and execute this script as ./ks_islandora.cfg
#
# Script to automatically install Drupal, Fedora Commons, and Islandora Modules
#
# 1/9/2014 SLY

# Assumptions:
#
#  - Databases are created in MySQL and you have DB names, users, and passwords for them. 
#     ( one for Fedora Commons and one for Drupal )

#
# Update OS
#
yum -y update
#
# Install any other packages on the OS if needed
#
# yum -y install <package_name>-<package-version>
#
yum -y install gcc
yum -y install gcc-c++
yum -y install autoconf
yum -y install java-1.6.0-openjdk.x86_64
yum -y install ImageMagick
yum -y install ghostscript
yum -y install ant
yum -y install git
#
# Enable EPEL
#
rpm -ivh http://download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm
#
# Enable RPM Fusion Repo
rpm -ivh http://download1.rpmfusion.org/free/el/updates/6/i386/rpmfusion-free-release-6-1.noarch.rpm
#
# Get RPM Fusion softwares
#
yum -y install ffmpeg
yum -y install xpdf
#
# ffmpeg2theora
#
wget http://v2v.cc/~j/ffmpeg2theora/ffmpeg2theora-0.29.linux64.bin
install -m 755 ffmpeg2theora-0.29.linux64.bin /usr/bin/ffmpeg2theora
#
# End of Operating System Setup
################################


#---------------------------------------------
#
# Variable Declaration (edit these)
#
#---------------------------------------------
#
#
## Set up installation variables
#
export SERVER_NAME=collections
export INSTALL_PREFIX=/opt
export WEB_ROOT=/var/www/html
export IP_ADDR="XX.XX.XX.XX"
export SITES_ALL_MODULES=$WEB_ROOT/sites/all/modules
export SITES_ALL_LIB=$WEB_ROOT/sites/all/libraries
#
## Variables to be passed to env.sh
export FEDORA_HOME=/opt/fedora
export FEDORA_USER=fedora
export ISLANDORA_HOME=/opt/islandora
export SOLR_HOME=/opt/solr
export JAVA_HOME=/opt/islandora/packages/jdk1.6.0_27
#
## Variables to be passed to database.sh
export DB_SERVER=localhost
export DRUPAL_ROOT=/var/www/html		# Top level of the drupal web root
export DRUPAL_DB_NAME="db_name"          	# Drupal database name
export DRUPAL_DB_USER="db_user"          	# Drupal username for settings.php file
export DRUPAL_DB_PASS="password"           	# Drupal password for settings.php file
export DRUPAL_ADMIN_USER="IslandoraAdmin"       # Drupal admin username to log into Drupal Site
export DRUPAL_ADMIN_PASS="pass"       		# Drupal admin password to log into Drupal Site
export DRUPAL_SITE_NAME="Islandora Sandbox"     # Drupal site name - displayed on the web site
export DRUPAL_DB_PREFIX="drup_"
export FEDORA_DB_NAME="fedora3"        		# Name of fedora MySQL database -> fedora3 is recommeneded
export FEDORA_DB_USER="db_user"        		# Fedora db username -> for fedora.fcfg file
export FEDORA_DB_PASS="password"         	# Fedora db password -> for fedora.fcfg file
export FEDORA_ADMIN_USER="fedoraAdmin"          # Username for http://localhost:8080/fedora/admin
export FEDORA_ADMIN_PASS="password"          	# Password for http://localhost:8080/fedora/admin


# 
# Get the hamhpc/islandora Git Repo
#
cd $INSTALL_PREFIX
git clone git://github.com/hamhpc/islandora.git

#---------------------------------------------
#
# Configure environment variables
#
#---------------------------------------------
#
$INSTALL_PREFIX/islandora/sbin/initialize_env.sh
. $INSTALL_PREFIX/islandora/etc/env.sh
. $INSTALL_PREFIX/islandora/etc/database.sh


#---------------------------------------------
#
# Do the installation
#
#---------------------------------------------
#
$ISLANDORA_HOME/sbin/software_dependancies.install
$ISLANDORA_HOME/sbin/drupal.install
$ISLANDORA_HOME/sbin/fedora.install
$ISLANDORA_HOME/sbin/djatoka.install
$ISLANDORA_HOME/sbin/islandora_modules.install

%end
# If this is not used in kickstart, remove the above line
